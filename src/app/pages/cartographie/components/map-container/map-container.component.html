<div class="map-wrapper"
     (dragover)="onDragOver($event)"
     (dragleave)="onDragLeave($event)"
     (drop)="onDrop($event)">

  <!-- Carte principale -->
  <div #mapElement class="map-element"></div>

  <!-- Input fichier caché -->
  <input
    #fileInput
    type="file"
    accept=".gml,.xml"
    style="display: none"
    (change)="onFileSelected($event)">

  <!-- Barre d'outils latérale -->
  <app-carto-toolbar
    class="toolbar"
    (zoomIn)="onZoomIn()"
    (zoomOut)="onZoomOut()"
    (zoomToExtent)="onZoomToExtent()"
    (toggleLayers)="toggleLayerPanel()"
    (loadFile)="openFileSelector()">
  </app-carto-toolbar>

  <!-- Panneau des couches (Phase 2) -->
  <app-layer-panel
    [isOpen]="isLayerPanelOpen()"
    (close)="toggleLayerPanel()">
  </app-layer-panel>

  <!-- Légende dynamique (Phase 2) -->
  <app-legend></app-legend>

  <!-- Sélecteur de fond de carte (Phase 2) -->
  <app-base-map-selector></app-base-map-selector>

  <!-- Barre d'état -->
  <app-carto-status-bar
    class="status-bar"
    [coordinates]="mapService.cursorPosition()"
    [zoom]="mapService.currentZoom()"
    [crs]="projectionService.getCurrentCRS()"
    [featureCount]="totalFeatureCount()">
  </app-carto-status-bar>

  <!-- Zone de drop (affichée quand aucune donnée) -->
  <div class="drop-zone"
       *ngIf="features().length === 0 && !isLoading()"
       [class.drag-over]="isDragging()">
    <div class="drop-content">
      <ion-icon name="cloud-upload-outline"></ion-icon>
      <p class="drop-title">Déposez un fichier GML ici</p>
      <p class="drop-hint">ou</p>
      <button class="file-btn" (click)="openFileSelector()">
        <ion-icon name="folder-open-outline"></ion-icon>
        Parcourir...
      </button>
    </div>
  </div>

  <!-- Indicateur de chargement -->
  <div class="loading-overlay" *ngIf="isLoading()">
    <ion-spinner name="crescent"></ion-spinner>
    <p>Chargement du fichier GML...</p>
  </div>

  <!-- Message d'erreur -->
  <div class="error-toast" *ngIf="errorMessage()">
    <ion-icon name="alert-circle-outline"></ion-icon>
    <span>{{ errorMessage() }}</span>
    <button (click)="errorMessage.set(null)">
      <ion-icon name="close-outline"></ion-icon>
    </button>
  </div>

</div>