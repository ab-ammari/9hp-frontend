<ion-row class="h-auto justify-content-end row-background">
  <ion-col class="p-0" >
    <ion-buttons>
      <ion-button size="small" id="sync-update">
        Derniere mise à jour :
        {{
          this.index?.last_updated | date: 'short'
        }}
      </ion-button>
    </ion-buttons>
    <ion-popover trigger="sync-update" triggerAction="click">
      <ng-template>
          <ion-list>
            <ion-item [button]="true" (click)="loadIndex(this.index?.last_updated)">
              Mettre à jour
            </ion-item>
            <ion-item  [button]="true"  (click)="loadIndex()">
              Recharger l'index
            </ion-item>
            <ion-item *ngIf="this.w.data().isOwner" >
              <ion-toggle [slot]="'end'" [(ngModel)]="w.data().showAdmin"></ion-toggle>
              <ion-label>Mode admin</ion-label>
            </ion-item>
            <ion-item [button]="true" id="exportOptions" >
              Export
            </ion-item>


            <ion-popover  [showBackdrop]="true" trigger="exportOptions" triggerAction="click">
              <ng-template>
                <ion-list>
                  <ion-item [button]="true"  [id]="table" *ngFor="let table of [
                  ApiDbTable.secteur,
                  ApiDbTable.fait,
                  ApiDbTable.us,
                  ApiDbTable.ensemble,
                  ApiDbTable.section_sondage,
                  ApiDbTable.echantillon_mobilier,
                  ApiDbTable.echantillon_prelevement,
                  ApiDbTable.contenant,
                  ApiDbTable.document_minute,
                  ApiDbTable.document_photo,
                  ApiDbTable.topo
                  ]">
                    <ion-label>{{table}}</ion-label>
                    <ion-popover [trigger]="table" [showBackdrop]="true"><ng-template>
                      <app-castor-btn-csv-downloader [table]="table"></app-castor-btn-csv-downloader>
                    </ng-template></ion-popover>
                  </ion-item>
                </ion-list>
              </ng-template>
            </ion-popover>
          </ion-list>
      </ng-template>
    </ion-popover>
  </ion-col>
  <ion-col size="auto">
    <ion-label class="fw-bold project-location">
      <ion-icon *ngIf="this.w.data()?.projet?.selected?.item?.write_lock_enabled" name="lock-closed-outline" class="lock-icon"></ion-icon>
      {{ this.w.data()?.projet?.selected?.item?.commune ?? 'Pas de commune'}} - {{ this.w.data()?.projet?.selected?.item?.lieu_dit ?? 'Pas de lieu dit'}}
    </ion-label>
  </ion-col>

  <ion-col size="auto">
    <div *ngIf="this.w.data().status.online" class="online-dot" [matTooltip]="'Online'"></div>
    <div *ngIf="!this.w.data().status.online" class="offline-dot" [matTooltip]="'Offline'"></div>
  </ion-col>
</ion-row>

